package ConceptGraph;

        import ConceptGraph.DataStructures.WikiPage;
        import ConceptGraph.Input.WikiPageXmlParser;
        import junit.framework.Test;
        import junit.framework.TestCase;
        import junit.framework.TestSuite;
        import org.apache.commons.lang3.StringEscapeUtils;
        import org.xml.sax.SAXException;

        import javax.xml.parsers.ParserConfigurationException;
        import java.io.IOException;
/**
 * Created by Dan on 18/11/2015.
 */
public class WikiPageXmlParserTest extends TestCase {
    public WikiPageXmlParserTest( String testName )
    {
        super( testName );
    }

    public static Test suite()
    {
        return new TestSuite( SizedMaxArrayTest.class );
    }

    public void test_givenEmptyString_ReturnsNull() throws IOException, SAXException, ParserConfigurationException {
        WikiPageXmlParser parser = new WikiPageXmlParser();
        WikiPage result = parser.parse("");

        assertEquals(result, null);
    }

    public void test_givenSample_ReturnsWikiPage() throws IOException, SAXException, ParserConfigurationException {
        WikiPageXmlParser parser = new WikiPageXmlParser();
        WikiPage result = parser.parse(samplePage);
        assertNotNull(result);
    }

    public void test_givenSample_SetsTitleToAndronikosIIPalaiologos() throws IOException, SAXException, ParserConfigurationException {
        WikiPageXmlParser parser = new WikiPageXmlParser();
        WikiPage result = parser.parse(samplePage);
        assertEquals(result.title, "andronikos ii palaiologos");
    }

    public void test_givenSample_SetsRawTextToSampleText() throws IOException, SAXException, ParserConfigurationException {
        WikiPageXmlParser parser = new WikiPageXmlParser();
        WikiPage result = parser.parse(samplePage);
        assertEquals(result.rawText, StringEscapeUtils.unescapeHtml4(sampleText)); //.unescapeHtml(sampleText));
    }

    public void test_givenSample_StripsTagsFromText() throws IOException, SAXException, ParserConfigurationException {
        WikiPageXmlParser parser = new WikiPageXmlParser();
        WikiPage result = parser.parse(samplePage);
        assertFalse(result.getStrippedText().contains("<")); //.unescapeHtml(sampleText));
    }

    private static final String sampleText = "{{Use dmy dates|date=July 2013}}{{Infobox monarch| name            = Andronikos II Palaiologos&lt;br&gt;Ανδρόνικος Β' Παλαιολόγος| full name       = Andronikos II Doukas Angelos Palaiologos| image           = Andronikos II Palaiologos (head).jpg| image_size            = 200px| caption         = Painting of Andronikos II| succession      = [[List of Byzantine emperors|Emperor]] of the [[Byzantine Empire]]| reign           = 1272 – 1328| coronation      = 1272| predecessor     = [[Michael VIII Palaiologos]] (alone)| successor      = [[Andronikos III Palaiologos]]| spouse          = [[Anna of Hungary (1260–1281)|Anna of Hungary]]&lt;br&gt;[[Irene of Montferrat|Yolande of Montferrat]]| issue           = [[Michael IX Palaiologos]]&lt;br&gt;[[Constantine Palaiologos (son of Andronikos II)|Constantine Palaiologos]]&lt;br&gt;[[John Palaiologos (son of Andronikos II)|John Palaiologos]]&lt;br&gt;[[Theodore I, Marquess of Montferrat]]&lt;br&gt;[[Demetrios Palaiologos (son of Andronikos II)|Demetrios Palaiologos]]&lt;br&gt;[[Simonida|Simonis]], Queen of Serbia&lt;br&gt;[[Irene Palaiologina]], Sebastokratorissa of Thessaly &lt;small&gt;(illegitimate)&lt;/small&gt;&lt;br&gt;Maria, Khatun of the Golden Horde &lt;small&gt;(illegitimate)&lt;/small&gt;| house           = [[Palaiologos|House of Palaiologos]]| father          = [[Michael VIII Palaiologos]]| mother          = [[Theodora Doukaina Vatatzina]]| birth_date   = 25 March 1259| birth_place  = [[İznik|Nicaea]], [[Byzantine Empire]]| death_date   = 13 February 1332 (aged 72)| death_place  = [[Constantinople]], [[Byzantine Empire]]| place of burial =}}'''Andronikos&amp;nbsp;II Palaiologos''' ({{lang-grc-gre|Ανδρόνικος Βʹ Παλαιολόγος}}; 25 March 1259&amp;nbsp;&amp;ndash; 13 February 1332), usually [[Latinization of names|Latinized]] as '''Andronicus&amp;nbsp;II Palaeologus''', was [[Byzantine emperor]] from 11 December 1282 to 23 or 24 May 1328.{{sfn|PLP|loc=21436. Παλαιολόγος, Ἀνδρόνικος II. Δούκας Ἄγγελος Κομνηνός}} Born '''Andronikos Doukas Angelos Komnenos Palaiologos''' ({{lang-grc-gre|Ἀνδρόνικος Δούκας Ἄγγελος Κομνηνός Παλαιολόγος}}), he was the eldest surviving son of [[Michael VIII Palaiologos]] and [[Theodora Doukaina Vatatzina]], grandniece of [[John III Doukas Vatatzes]].{{TOClimit|2}}==Life==Andronikos II was born at [[Nicaea]]. He was acclaimed co-emperor in 1261, after his father Michael VIII recovered [[Constantinople]] from the [[Latin Empire]], but he wasn't crowned until 1272. Sole emperor from 1282, Andronikos II immediately repudiated his father's unpopular Church union with the [[Papacy]], which he had been forced to support while his father was still alive, but he was unable to resolve the related schism within the Orthodox clergy until 1310.Andronikos II was also plagued by economic difficulties. During his reign the value of the Byzantine ''[[hyperpyron]]'' depreciated precipitously, while the state treasury accumulated less than one seventh the revenue (in nominal coins) that it had previously. Seeking to increase revenue and reduce expenses, Andronikos II raised taxes, reduced tax exemptions, and dismantled the Byzantine fleet (80 ships) in 1285, thereby making the Empire increasingly dependent on the rival republics of [[Republic of Venice|Venice]] and [[Republic of Genoa|Genoa]]. In 1291, he hired 50–60 Genoese ships, but the Byzantine weakness resulting from the lack of a navy became painfully apparent in the two wars with Venice in [[Byzantine–Venetian War (1296–1302)|1296–1302]] and [[Byzantine–Venetian War (1306–10)|1306–10]]. Later, in 1320, he tried to resurrect the navy by constructing 20 galleys, but failed.Andronikos II Palaiologos sought to resolve some of the problems facing the [[Byzantine Empire]] through diplomacy. After the death of his first wife Anne of Hungary, he married [[Irene of Montferrat|Yolanda (renamed Irene) of Montferrat]], putting an end to the Montferrat claim to the [[Kingdom of Thessalonica]]. Andronikos II also attempted to marry off his son and co-emperor [[Michael IX Palaiologos]] to the Latin Empress [[Catherine I of Courtenay]], thus seeking to eliminate Western agitation for a restoration of the Latin Empire. Another marriage alliance attempted to resolve the potential conflict with [[Serbia]] in [[Macedonia (region)|Macedonia]], as Andronikos II married off his five-year-old daughter [[Simonida|Simonis]] to King [[Stefan Milutin]] in 1298.[[Image:AndronikosIIandMichaelIXPalaeologusSilverBasilikon.jpg|thumb|left|Andronikos II and [[Michael IX Palaeologus]] (Silver basilikon)]]In spite of the resolution of problems in [[Europe]], Andronikos II was faced with the collapse of the Byzantine frontier in [[Asia Minor]], despite the successful, but short, governorships of [[Alexios Philanthropenos]] and [[John Tarchaneiotes]]. The successful military victories in Asia Minor by [[Alexios Philanthropenos]] and [[John Tarchaneiotes]] against the Turks were largely dependent on a considerable military contingent of Cretan escapees, or exiles from Venetian-occupied Crete, headed by Hortatzis, whom [[Michael VIII]] had repatriated to Byzantium through a treaty agreement with the Venetians ratified in 1277.&lt;ref&gt;Agelarakis, P. A. (2012), Cretans in Byzantine foreign policy and military affairs following the Fourth Crusade. Cretika Chronika, 32, 41-78.&lt;/ref&gt; Andronikos II had resettled those Cretans in the region of Meander river, the southeastern Asia Minor frontier of Byzantium with the Turks.After the failure of the co-emperor Michael IX to stem the Turkish advance in Asia Minor in 1302 and the disastrous [[Battle of Bapheus]], the Byzantine government hired the [[Catalan Company]] of [[Almogavars]] (adventurers from  [[Catalonia]]) led by Roger de Flor to clear Byzantine Asia Minor of the enemy. In spite of some successes, the Catalans were unable to secure lasting gains. Being more ruthless and savage than the enemy they intended to subdue they quarreled with Michael IX, and eventually openly turned on their Byzantine employers after the murder of Roger de Flor in 1305, devastating together with a party of willing Turks [[Thrace]], Macedonia, and [[Thessaly]] on their road to Latin occupied southern Greece. There they conquered the [[Duchy of Athens]] and [[Thebes, Greece|Thebes]]. The Turks continued to penetrate the Byzantine possessions, and [[Bursa, Turkey|Prusa]] fell in 1326. By the end of Andronikos II's reign, much of Bithynia was in the hands of the [[Ottoman Turks]] of Osman I and his son and heir [[Orhan I|Orhan]].{{sfnp|EB|1878}}{{sfnp|EB|1911}} Also, [[Karasids]] conquered [[Mysia]]-region with [[Balıkesir|Paleokastron]] after 1296, Germiyan conquered [[Simav]] in 1328, Saruhan captured [[Manisa|Magnesia]] in 1313, and [[Aydinids]] captured [[İzmir|Smyrna]] in 1310.[[File:AndronicosIIGoldHyperpyron.jpg|thumb|Gold [[hyperpyron]] of Andronikos II, kneeling before Christ.]]The Empire's problems were exploited by [[Theodore Svetoslav of Bulgaria]], who defeated Michael IX and conquered much of northeastern Thrace in c. 1305–07. The conflict ended with yet another dynastic marriage, between Michael IX's daughter Theodora and the Bulgarian emperor. The dissolute behavior of Michael IX's son [[Andronikos III Palaiologos]] led to a rift in the family, and after Michael IX's death in 1320, Andronikos II disowned his grandson, prompting a [[First Palaiologan Civil War|civil war]] that raged, with interruptions, until 1328. The conflict precipitated Bulgarian involvement, and [[Michael Shishman of Bulgaria|Michael Asen III of Bulgaria]] attempted to capture Andronikos II under the guise of sending him military support. In 1328 Andronikos III entered Constantinople in triumph and Andronikos II was forced to abdicate.Andronikos II died as a monk at Constantinople in 1332.==Family==On 8 November 1273 Andronikos II married as his first wife [[Anna of Hungary (1260–1281)|Anna of Hungary]], daughter of [[Stephen V of Hungary]] and [[Elizabeth the Cuman]], with whom he had two sons:* [[Michael IX Palaiologos]] (17 April 1277 – 12 October 1320).* [[Constantine Palaiologos (son of Andronikos II)|Constantine Palaiologos]], ''[[despotes]]'' (c. 1278 – 1335). Constantine was forced to become a monk by his nephew [[Andronikos III Palaiologos]].Anna died in 1281, and in 1284 Andronikos married [[Irene of Montferrat|Yolanda (renamed Irene)]], a daughter of [[William VII of Montferrat]], with whom he had:* [[John Palaiologos (son of Andronikos II)|John Palaiologos]].* [[Theodore I of Montferrat|Theodore]], [[Marquis of Montferrat]]* [[Demetrios Palaiologos (son of Andronikos II)|Demetrios Palaiologos]] (d. after 1343), ''despotes''. Father of [[Irene Palaiologina (Byzantine empress)|Irene Palaiologina]].* [[Simonida|Simonis Palaiologina]] (1294-after 1336), who married King [[Stefan Milutin]] of SerbiaAndronikos II also had at least two illegitimate daughters:* Irene, who married [[John II Doukas]], ruler of [[Thessaly]]* Maria, who married [[Toqta]], Khan of the [[Golden Horde]]==Ancestry=={{unreferenced section|date=December 2014}}{{ahnentafel top|width=100%}}&lt;center&gt;{{ahnentafel-compact5|style=font-size: 90%; line-height: 110%;|border=1|boxstyle=padding-top: 0; padding-bottom: 0;|boxstyle_1=background-color: #fcc;|boxstyle_2=background-color: #fb9;|boxstyle_3=background-color: #ffc;|boxstyle_4=background-color: #bfc;|boxstyle_5=background-color: #9fe;|1= 1. '''Andronikos II Palaiologos '''|2= 2. [[Michael VIII Palaiologos]]|3= 3. [[Theodora Doukaina Vatatzina]]|4= 4. Andronikos Doukas Komnenos Palaiologos|5= 5. Theodora Angelina Palaiologina|6= 6. John Doukas Vatatzes|7= 7. Eudokia Angelina|8= 8. [[Alexios Palaiologos (megas doux)|Alexios Palaiologos]]|9= 9. Eirene Komnene|10= 10. [[Alexios Palaiologos (Despot)|Alexios Palaiologos]]|11= 11. Eirene Komnene Angelina|12= 12. Isaac Doukas Vatatzes|13=|14= 14. John Komnenos Angelos|15=|16= 16.  ?Michael Doukas Palaiologos?|17=|18= 18. John Kantakouzenos|19= 19. Maria Komnene|20= 20. George Komnenodoukas Palaiologos|21= 21. ?Eirene Komnene Kantakouzene?|22= 22. [[Alexios III Angelos]]|23= 23. [[Euphrosyne Doukaina Kamatera]]|24= 24. Basil Vatatzes|25= 25. cousin of 22}}&lt;/center&gt;{{ahnentafel bottom}}==References=====Citations==={{Reflist}}===Bibliography===* {{cite book | first = Mark C. | last = Bartusis | title = The Late Byzantine Army: Arms and Society 1204–1453 | publisher = University of Pennsylvania Press | year = 1997 | isbn = 978-0-8122-1620-2 | url=http://books.google.com/books?id=rUs-hHd89xAC}}* {{citation |contribution=[[s:Encyclopædia Britannica, Ninth Edition/Andronicus II.|Andronicus II.]] |title=''[[s:Encyclopædia Britannica, Ninth Edition|''Encyclopædia Britannica'', 9th ed.]], [[s:Encyclopædia Britannica, Ninth Edition/Volume II|Vol.&amp;nbsp;II]]'' |editor-last=Baynes |editor-first=Thomas Spencer |display-editors=0 |publisher=Charles Scribner's Sons |location=New York |date=1878 |ref={{harvid|EB|1878}} |p=23 }}.* {{citation |contribution=[[s:1911 Encyclopædia Britannica/Andronicus II.|Andronicus II.]] |title=''[[s:1911 Encyclopædia Britannica|''Encyclopædia Britannica'', 11th ed.]], [[s:1911 Encyclopædia Britannica/Volume I|Vol.&amp;nbsp;I]]'' |editor-last=Chisholm |editor-first=Hugh |editor2-last=Phillips |editor2-first=Walter Alison |display-editors=0 |publisher=Cambridge University Press |location=[[Cambridge, England|Cambridge]] |date=1911 |ref={{harvid|EB|1911}} |p=976}}.* {{cite book | first = John Van Antwerp | last = Fine | title = The Late Medieval Balkans: A Critical Survey from the Late Twelfth Century to the Ottoman Conquest | publisher = University of Michigan Press | year = 1994 | isbn = 978-0-472-08260-5 | url=http://books.google.com/books?id=Hh0Bu8C66TsC}}* {{cite book | editor-first = Alexander | editor-last = Kazhdan | editor-link = Alexander Kazhdan | title = [[Oxford Dictionary of Byzantium]] | publisher = Oxford University Press | year = 1991 | isbn = 978-0-19-504652-6}}* {{cite book | first = Angeliki E. | last = Laiou | authorlink = Angeliki Laiou | title = Constantinople and the Latins: The Foreign Policy of Andronicus II, 1282–1328 | publisher = Harvard University Press | year = 1972 | isbn = 0-674-16535-7}}* {{cite book | first = Αναστασία | last = Κοντογιαννοπούλου | title = Η εσωτερική πολιτική του Ανδρονίκου Β΄ Παλαιολόγου (1282-1328). Διοίκηση - Οικονομία | publisher = Κέντρο Βυζαντινών Ερευνών Θεσσαλονίκη | year = 2004 | isbn = 960-7856-15-5}}* {{cite book | title=The Last Centuries of Byzantium, 1261–1453 | first=Donald MacGillivray | last=Nicol | authorlink = Donald Nicol | publisher=Cambridge University Press | year=1993 | isbn=978-0-521-43991-6 | url=http://books.google.com/books?id=y2d6OHLqwEsC}}* {{cite encyclopedia | last1=Trapp | first1=Erich | last2=Beyer | first2=Hans-Veit | encyclopedia=[[Prosopographisches Lexikon der Palaiologenzeit]] | volume=I, 1–12, Add. 1–2, CD-ROM Version | publisher=Verlag der Österreichischen Akademie der Wissenschaften | location=Vienna | year=2001 | language=German | isbn = 978-3-7001-3003-1 | ref = {{harvid|PLP}} }}* {{cite book |title=A History of the Byzantine State and Society |last=Treadgold  |first=Warren T. |year=1997  |publisher=Stanford University Press  |isbn=0-8047-2630-2}}==External links==* {{commons category inline|Andronikos II Palaiologos}}{{s-start}}{{s-hou|[[Palaiologos]] dynasty|Unknown|1259|13 February|1332}}{{s-reg|}}{{s-bef|before=[[Michael VIII Palaiologos]]}}{{s-ttl|title=[[List of Byzantine Emperors|Byzantine Emperor]]|years=1272–1328|regent1=[[Michael VIII Palaiologos]]|years1=1260–1282|regent2=[[Michael IX Palaiologos]]|years2=1294–1320}}{{s-aft|after=[[Andronikos III Palaiologos]]}}{{s-end}}{{Roman Emperors}}{{Authority control}}{{DEFAULTSORT:Andronikos 02 Palaiologos}}[[Category:1259 births]][[Category:1332 deaths]][[Category:Palaiologos dynasty]][[Category:13th-century Byzantine emperors]][[Category:14th-century Byzantine emperors]][[Category:Monarchs who abdicated]][[Category:Eastern Orthodox monks]][[Category:Orthodox monarchs]][[Category:Burials at Lips Monastery]]";
    private static final String samplePage = "  <page>    <title>Andronikos II Palaiologos</title>    <ns>0</ns>    <id>1761</id>    <revision>      <id>682346914</id>      <parentid>675927872</parentid>      <timestamp>2015-09-23T04:00:32Z</timestamp>      <contributor>        <username>Koavf</username>        <id>205121</id>      </contributor>      <comment>/* External links */Deleting per CfD, funcationality replaced by Wikidata, removed: {{Persondata using [[Project:AWB|AWB]]</comment>      <model>wikitext</model>      <format>text/x-wiki</format>      <text xml:space=\"preserve\">" + sampleText + "</text>      <sha1>93qtrwvfgm8wqgh2ndmch60c9jkpdnt</sha1>    </revision>  </page>\n";
}
